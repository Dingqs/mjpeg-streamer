<!DOCTYPE html>
<html>
	<head>
		<title>Web Socket Test</title>
		<meta charset="utf-8">
		<style type="text/css">
		#container { width:640px; margin: 0 auto; text-align: center; }
		#port { border: 1px solid #000 }
		#play-buttons { margin: 10px auto; }
		</style>
	</head>
	<body>
		<div id="container">
			<h1>Web Socket Streamer</h1>
			<canvas id="port" width="640" height="480"></canvas>
			
			<div id="play-buttons">
				Bin: <input id="is-bin" type="checkbox">
				<button id="connect-button" type="button">Connect</button>
				<input id="send-text" type="text" />
				<button id="send-button" type="button">Send</button>
				<button id="close-button" type="button">Disconnect</button>
			</div>
			
			
		</div>
		
		<script type="text/javascript">
var canvas, ws, context, bin;

canvas = document.getElementById("port");
context = canvas.getContext("2d");

		
/* Event handlers. */
document.getElementById("connect-button").onclick = function() {
    ws = new WebSocket("MJpegStreamer/ws?stream=coupledtanks1&timestamp=t&bin=t");
    ws.onerror = function(error) {
    	console.log(error)  
    };

    ws.onmessage = function(message) {
      	drawImage(message.data);
    	
      	setTimeout(function() {
      	    ws.send("p");
      	}, 30);
    };
    
    ws.onopen = function() {
        console.log("Connection opened");
      	ws.send("p");  
    };
};
document.getElementById("send-button").onclick = function() {
  	ws.send(document.getElementById("send-text").value);
};

document.getElementById("close-button").onclick = function() {
  	ws.close();
};

function drawImage(data) {
  	  var img = new Image();
  	  img.addEventListener("load", function() {
  	     canvas.drawImage(img, 0, 0); 
  	  });
  	  img.src = data;
};

		</script>
	</body>
</html>